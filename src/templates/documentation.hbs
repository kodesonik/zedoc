<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}} - API Documentation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        {{{themeCSS}}}
        {{{fontCSS}}}
        {{{sidebarCSS}}}
        {{{brandingCSS}}}
    </style>
</head>
<body class="light">
    <button class="mobile-menu-btn">‚ò∞</button>
    
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="header-top">
                    <div class="logo">
                        {{#if branding.logo}}
                            {{{headerLogoHTML}}}
                        {{else}}
                            {{title}}
                        {{/if}}
                    </div>
                    <button class="theme-toggle">üåô</button>
                </div>
                <div class="subtitle">API Documentation</div>
                {{#if version}}
                <div class="version-badge">v{{version}}</div>
                {{/if}}
            </div>
            
            <!-- Search and Filter -->
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search endpoints..." />
                <div class="role-filter">
                    <label class="role-filter-label">Filter by tag:</label>
                    <div class="role-buttons">
                        <button class="role-btn active" data-role="all">All</button>
                        {{#each tags}}
                        <button class="role-btn" data-role="{{this}}">{{this}}</button>
                        {{/each}}
                    </div>
                </div>
            </div>

            <!-- Navigation Sections -->
            {{#if sections}}
                {{#each sections}}
                <div class="nav-section">
                    <div class="nav-title">{{name}}</div>
                    {{#each modules}}
                    <a href="#{{id}}" class="nav-item">{{name}}</a>
                    {{/each}}
                </div>
                {{/each}}
            {{else}}
                <!-- Fallback for non-structured mode -->
                <div class="nav-section">
                    <div class="nav-title">Endpoints</div>
                    {{#each endpoints}}
                    <a href="#{{endpointId this}}" class="nav-item">{{method}} {{path}}</a>
                    {{/each}}
                </div>
            {{/if}}
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <h1 class="page-title">{{title}} API</h1>
                {{#if description}}
                <p class="page-description">{{description}}</p>
                {{/if}}
            </div>

            <!-- Getting Started Section -->
            <section id="getting-started" class="module-section">
                <h2 class="module-title">Getting Started</h2>
                <div class="endpoint-card">
                    <div class="endpoint-details expanded">
                        <div class="detail-section">
                            <h4 class="detail-title">Base URL</h4>
                            <div class="code-block">{{baseUrl}}</div>
                        </div>
                        <div class="detail-section">
                            <h4 class="detail-title">Content Type</h4>
                            <div class="code-block">application/json</div>
                        </div>
                        {{#if version}}
                        <div class="detail-section">
                            <h4 class="detail-title">API Version</h4>
                            <p>Current version: <code>{{version}}</code></p>
                        </div>
                        {{/if}}
                        {{#if environment}}
                        <div class="detail-section">
                            <h4 class="detail-title">Environment</h4>
                            {{{environmentHTML}}}
                        </div>
                        {{/if}}
                    </div>
                </div>
            </section>

            <!-- Structured Mode: Sections and Modules -->
            {{#if sections}}
                {{#each sections}}
                <section id="{{sectionId id}}" class="section">
                    <h2 class="section-title">{{name}}</h2>
                    {{#if description}}
                    <p class="section-description">{{description}}</p>
                    {{/if}}
                    
                    {{#each modules}}
                    <section id="{{moduleId ../id id}}" class="module-section">
                        <h3 class="module-title">{{name}}</h3>
                        {{#if description}}
                        <p class="module-description">{{description}}</p>
                        {{/if}}
                        
                        {{#each endpoints}}
                        <div class="endpoint-card" data-tags="{{formatTags tags}}">
                            <div class="endpoint-header">
                                <span class="method-badge method-{{lowercase method}}">{{method}}</span>
                                <span class="endpoint-path">{{path}}</span>
                                <span class="endpoint-summary">{{summary}}</span>
                                <button class="try-button" data-method="{{method}}" data-path="{{path}}" data-endpoint-id="{{structuredEndpointId ../../id ../id this}}">Try</button>
                            </div>
                            <div class="endpoint-details">
                                {{#if description}}
                                <div class="detail-section">
                                    <h4 class="detail-title">Description</h4>
                                    <p>{{description}}</p>
                                </div>
                                {{/if}}
                                
                                <div class="detail-section">
                                    <h4 class="detail-title">Authentication</h4>
                                    {{#if requiresAuth}}
                                    <p>üîí Authentication Required</p>
                                    {{else}}
                                    <p>üåê Public Endpoint</p>
                                    {{/if}}
                                </div>
                                
                                {{#if tags}}
                                <div class="detail-section">
                                    <h4 class="detail-title">Tags</h4>
                                    <p>{{formatTags tags}}</p>
                                </div>
                                {{/if}}
                                
                                <div class="detail-section">
                                    <h4 class="detail-title">Request URL</h4>
                                    <div class="code-block">{{method}} {{../../../baseUrl}}{{path}}</div>
                                </div>
                                
                                {{#if parameters}}
                                <div class="detail-section">
                                    <h4 class="detail-title">Parameters</h4>
                                    <div class="code-block json-code">
                                        <pre><code class="language-json">{{json parameters}}</code></pre>
                                    </div>
                                </div>
                                {{/if}}
                                
                                {{#if requestHeaders}}
                                <div class="detail-section">
                                    <h4 class="detail-title">Request Headers</h4>
                                    <div class="code-block json-code">
                                        <pre><code class="language-json">{{json requestHeaders}}</code></pre>
                                    </div>
                                </div>
                                {{/if}}
                                
                                {{#if requestBody}}
                                <div class="detail-section">
                                    <h4 class="detail-title">Request Body</h4>
                                    <div class="code-block json-code">
                                        <pre><code class="language-json">{{json requestBody}}</code></pre>
                                    </div>
                                </div>
                                {{/if}}
                                
                                {{#if requestExamples}}
                                <div class="detail-section">
                                    <h4 class="detail-title">Request Examples</h4>
                                    {{#each requestExamples}}
                                    <div class="code-block json-code">
                                        <pre><code class="language-json">{{json this}}</code></pre>
                                    </div>
                                    {{/each}}
                                </div>
                                {{/if}}
                                
                                {{#if successResponse}}
                                <div class="detail-section">
                                    <h4 class="detail-title">‚úÖ Success Response</h4>
                                    <div class="code-block json-code">
                                        <pre><code class="language-json">{{json successResponse}}</code></pre>
                                    </div>
                                </div>
                                {{/if}}
                                
                                {{#if responseExamples}}
                                <div class="detail-section">
                                    <h4 class="detail-title">Response Examples</h4>
                                    {{#each responseExamples}}
                                    <div class="code-block json-code">
                                        <pre><code class="language-json">{{json this}}</code></pre>
                                    </div>
                                    {{/each}}
                                </div>
                                {{/if}}
                                
                                {{#if errorResponses}}
                                <div class="detail-section">
                                    <h4 class="detail-title">‚ùå Error Responses</h4>
                                    {{#each errorResponses}}
                                    <div class="error-response">
                                        <h5 class="error-status">{{status}} - {{description}}</h5>
                                        <div class="code-block json-code">
                                            <pre><code class="language-json">{{json this}}</code></pre>
                                        </div>
                                    </div>
                                    {{/each}}
                                </div>
                                {{/if}}
                            </div>
                        </div>
                        {{/each}}
                    </section>
                    {{/each}}
                </section>
                {{/each}}
            {{else}}
                <!-- Fallback: Traditional Swagger Mode -->
                {{#each endpoints}}
                <section id="{{endpointId this}}" class="module-section">
                    <div class="endpoint-card" data-tags="{{formatTags tags}}">
                        <div class="endpoint-header">
                            <span class="method-badge method-{{lowercase method}}">{{method}}</span>
                            <span class="endpoint-path">{{path}}</span>
                            <span class="endpoint-summary">{{summary}}</span>
                            <button class="try-button" data-method="{{method}}" data-path="{{path}}" data-endpoint-id="{{endpointId this}}">Try</button>
                        </div>
                        <div class="endpoint-details">
                            {{#if description}}
                            <div class="detail-section">
                                <h4 class="detail-title">Description</h4>
                                <p>{{description}}</p>
                            </div>
                            {{/if}}
                            
                            {{#if tags}}
                            <div class="detail-section">
                                <h4 class="detail-title">Tags</h4>
                                <p>{{formatTags tags}}</p>
                            </div>
                            {{/if}}
                            
                            {{#if parameters}}
                            <div class="detail-section">
                                <h4 class="detail-title">Parameters</h4>
                                <div class="overflow-x-auto">
                                    <table class="params-table">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Type</th>
                                                <th>In</th>
                                                <th>Required</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {{#each parameters}}
                                            <tr>
                                                <td class="param-name">{{name}}</td>
                                                <td>{{type}}</td>
                                                <td>{{in}}</td>
                                                <td>{{#if required}}Yes{{else}}No{{/if}}</td>
                                                <td>{{description}}</td>
                                            </tr>
                                            {{/each}}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {{/if}}
                            
                            {{#if responses}}
                            <div class="detail-section">
                                <h4 class="detail-title">Responses</h4>
                                {{#each responses}}
                                <div class="response-item">
                                    <span class="response-status">{{statusCode}}</span>
                                    <span class="response-description">{{description}}</span>
                                </div>
                                {{/each}}
                            </div>
                            {{/if}}
                        </div>
                    </div>
                </section>
                {{/each}}
            {{/if}}
        </main>
    </div>

    <!-- API Testing Side Panel -->
    <div class="api-panel" id="apiPanel">
        <div class="api-panel-header">
            <div class="api-panel-title-section">
                <h3 class="api-panel-title">API Testing</h3>
                <div class="api-panel-subtitle" id="apiPanelSubtitle">Select an endpoint to test</div>
            </div>
            <button class="close-panel-btn" id="closePanelBtn">‚úï</button>
        </div>
        
        <div class="api-panel-content">
            <!-- Request Section -->
            <div class="request-section">
                <h4 class="section-title">Request</h4>
                
                <div class="request-url-section">
                    <label class="input-label">Method & URL</label>
                    <div class="url-input-group">
                        <select class="method-select" id="requestMethod">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="PATCH">PATCH</option>
                            <option value="DELETE">DELETE</option>
                        </select>
                        <input type="text" class="url-input" id="requestUrl" placeholder="Enter request URL">
                    </div>
                </div>
                
                <div class="headers-section">
                    <label class="input-label">Headers</label>
                    <div class="headers-form" id="headersForm">
                        <!-- Headers will be dynamically populated here -->
                    </div>
                    <button type="button" class="add-header-btn" id="addHeaderBtn">+ Add Header</button>
                </div>
                
                <div class="query-section" id="querySection" style="display: none;">
                    <label class="input-label">Query Parameters</label>
                    <div class="query-form" id="queryForm">
                        <!-- Query parameters will be dynamically populated here -->
                    </div>
                    <button type="button" class="add-query-btn" id="addQueryBtn">+ Add Parameter</button>
                </div>
                
                <div class="body-section">
                    <label class="input-label">Request Body</label>
                    <textarea class="body-textarea" id="requestBody" placeholder='{"key": "value"}'></textarea>
                </div>
                
                <button class="send-button" id="sendRequestBtn">Send Request</button>
            </div>
            
            <!-- Response Section -->
            <div class="response-section">
                <div class="response-header">
                    <h4 class="section-title">Response</h4>
                    <button class="export-button" id="exportResponseBtn" disabled>Export JSON</button>
                </div>
                
                <div class="response-status">
                    <label class="input-label">Status Code</label>
                    <div class="status-display" id="responseStatus">-</div>
                </div>
                
                <div class="response-headers">
                    <label class="input-label">Response Headers</label>
                    <textarea class="response-textarea" id="responseHeaders" readonly placeholder="Response headers will appear here..."></textarea>
                </div>
                
                <div class="response-body">
                    <label class="input-label">Response Body</label>
                    <textarea class="response-textarea" id="responseBody" readonly placeholder="Response body will appear here..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        // Inline JavaScript from services
        {{{sidebarJS}}}
        {{{environmentJS}}}
    </script>
    <!-- Import the main docs.js file with all interactive functionality -->
    <script>
        // Load docs.js from assets
        const script = document.createElement('script');
        script.src = './assets/docs.js';
        script.onload = function() {
            console.log('üìÑ Documentation interactive features loaded');
        };
        script.onerror = function() {
            console.warn('‚ö†Ô∏è Could not load docs.js - some interactive features may not work');
        };
        document.head.appendChild(script);
        
        // Initialize theme from URL parameter or localStorage
        document.addEventListener('DOMContentLoaded', function() {
            // Check for theme parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const themeParam = urlParams.get('theme');
            
            if (themeParam && (themeParam === 'light' || themeParam === 'dark')) {
                // Apply theme from URL parameter
                document.body.className = themeParam;
                
                // Save to localStorage
                localStorage.setItem('api-docs-theme', themeParam);
                console.log(`üé® Theme set from URL parameter: ${themeParam}`);
            } else {
                // Use server-side theme or default from localStorage
                const savedTheme = localStorage.getItem('api-docs-theme');
                const defaultTheme = '{{theme.mode}}' || 'light';
                const currentTheme = savedTheme || defaultTheme;
                
                document.body.className = currentTheme;
                console.log(`üé® Theme initialized: ${currentTheme}`);
            }
            
            // Update theme toggle icon
            updateThemeToggleIcon();
        });
        
        // Function to update theme toggle icon
        function updateThemeToggleIcon() {
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                const currentTheme = document.body.className;
                const icon = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                const title = currentTheme === 'light' ? 'Switch to Dark Mode' : 'Switch to Light Mode';
                
                themeToggle.innerHTML = icon;
                themeToggle.title = title;
            }
        }
        
        // Manual theme toggle function (fallback if docs.js doesn't load)
        function toggleTheme() {
            const currentTheme = document.body.className;
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.body.className = newTheme;
            localStorage.setItem('api-docs-theme', newTheme);
            updateThemeToggleIcon();
            
            console.log(`üé® Theme toggled to: ${newTheme}`);
        }
        
        // Add click listener to theme toggle button (fallback)
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }
        });
    </script>
</body>
</html> 